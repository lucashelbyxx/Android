[Android Interface Definition Language (AIDL)](https://developer.android.com/develop/background-work/services/aidl)



# AIDL

Android Interface Definition Language (AIDL)，与其他 [IDLs](https://en.wikipedia.org/wiki/Interface_description_language) 类似：允许你定义客户端和服务端都同意的编程接口，以便驻留在不同进程中的组件进行通信。



适用场景

仅当你允许来自不同应用程序的 client 访问你的 IPC service 并希望在你的 service 中处理多线程时，才需要 AIDL。如果不需要跨不同应用程序执行并发 IPC，则应通过实现 Binder 来创建接口。或者，如果要执行 IPC，但不需要处理多线程，请使用 Messenger 实现接口。



为什么使用 AIDL？

1. 进程间通信：AIDL主要用于进程间通信，使不同进程中的组件能够无缝交换数据和调用方法。在处理在与主应用程序不同的进程中运行的服务和后台任务时，这一点尤为重要。
2. 模块化：AIDL允许开发人员创建具有明确定义接口的不同组件，从而促进模块化。这种关注点分离增强了代码的可维护性和可扩展性。
3. 复用：AIDL接口促进代码复用。使用 AIDL 定义协定后，可以在应用程序的多个部分使用它，甚至可以在必要时在不同的应用程序之间共享它。
4. 性能：AIDL 针对 Android IPC 机制中的性能进行了优化。它可以有效地处理进程之间数据的序列化和反序列化，从而最大限度地减少开销。



AIDL 实现

1. 创建 AIDL 接口：通过在项目中创建 `.aidl` 文件来定义 AIDL 接口。此文件包含服务将向其他进程公开的方法签名和数据类型。
2. 实现 AIDL 接口：在服务或其他组件中实现 AIDL 接口。您必须确保实现符合定义的接口协定。
3. 注册服务：要使其他进程可以访问该服务，请在 AndroidManifest.xml 文件中注册该服务。
4. 绑定到服务：来自其他进程的客户端可以使用该 `bindService()` 方法绑定到服务，并访问其在 AIDL 接口中定义的方法。



AIDL 用例

1. 远程服务：AIDL 通常用于创建在后台执行任务并需要与主应用程序通信的远程服务。
2. 内容提供商：内容提供商通常使用 AIDL 安全地向其他应用公开数据和功能。
3. 自定义 IPC：当内置选项（例如基于意图的通信）不足以满足您的要求时，AIDL 可用于实现自定义 IPC 机制。
4. 插件架构：在具有插件架构的应用中，AIDL 可以促进核心应用与动态加载的插件之间的通信。
5. 跨应用通信：可以使用 AIDL 来实现不同 Android 应用之间的通信，这在应用之间共享数据等场景中非常有用。



AIDL 在实现 Android 应用中的进程间通信方面发挥着至关重要的作用。通过定义清晰的接口和协定，开发者可以创建模块化、可维护的高性能应用，充分利用 Android 基于组件的架构的强大功能。



设计 AIDL 接口之前，要注意对 AIDL 接口的调用是直接函数调用。不要对发生调用的线程做假设。视调用是来自本地进程中的线程还是远程进程，实际情况会有所不同：

- 来自本地进程的调用在发出调用的同一线程中执行。如果该线程是您的主界面线程，则该线程会继续在 AIDL 接口中执行。如果该线程是其他线程，则其便是在服务中执行您的代码的线程。因此，如果只有本地线程访问服务，您可以完全控制在其中执行的线程。但如果遇到这种情况，请不要使用 AIDL，而应通过[实现 `Binder`](https://developer.android.com/guide/components/bound-services?hl=zh-cn#Binder) 来创建接口。
- 来自远程进程的调用是从平台在您自己的进程内维护的线程池中分派的。准备好接收来自未知线程且同时发生多个调用的传入调用。换言之，AIDL 接口的实现必须是完全线程安全的。从同一远程对象上的一个线程发出的调用会*按顺序*到达接收器端。
- `oneway` 关键字用于修改远程调用的行为。使用它时，远程调用不会阻塞。它会发送交互数据并立即返回。该接口的实现最终会收到此调用，它是来自 `Binder` 线程池的常规调用，是正常远程调用。如果将 `oneway` 用于本地调用，则不会产生任何影响，调用仍是同步调用。



